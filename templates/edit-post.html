{% load static %}
<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8" />
    <title>TDP | Padayatra</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description" />
    <meta content="Themesbrand" name="author" />
    <!-- App favicon -->
    <link rel="shortcut icon" href="{% static 'assets/images/logo-dark.png' %}">

    <!-- Bootstrap Css -->
    <link href="{% static 'assets/css/bootstrap.min.css' %}" id="bootstrap-style" rel="stylesheet" type="text/css" />
    <!-- Icons Css -->
    <link href="{% static 'assets/css/icons.min.css' %}" rel="stylesheet" type="text/css" />
    <!-- App Css-->
    <link href="{% static 'assets/css/app.min.css' %}" id="app-style" rel="stylesheet" type="text/css" />
    <link href="{% static 'assets/libs/select2/css/select2.min.css' %}" rel="stylesheet" type="text/css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tagsinput/0.8.0/bootstrap-tagsinput.css"
        rel="stylesheet" />
    <style>
        #editor {
            resize: vertical;
            overflow: auto;
            line-height: 1.5;
            background-color: #fff;
            background-image: none;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            min-height: 150px;
            box-shadow: none;
            padding: 8px 16px;
            margin: 0 auto;
            font-size: 14px;
            transition: border-color 0.15s ease-in-out 0s, box-shadow 0.15s ease-in-out 0s;
        }

        #editor:focus {
            background-color: #f0f0f0;
            border-color: #38af5b;
            box-shadow: none;
            outline: 0 none;
        }

        .title h1,
        .title h2,
        .title h3,
        .title h4 {
            margin: 5px;
        }

        .title {
            position: relative;
            display: block;
            padding-bottom: 0;
            border-bottom: 3px double #dcdcdc;
            margin-bottom: 30px;
        }

        .title::before {
            width: 15%;
            height: 3px;
            background: #53bdff;
            position: absolute;
            bottom: -3px;
            content: '';
        }

        #editparent .btn {
            font-family: "Raleway", sans-serif;
            font-weight: 300;
            font-size: 1em;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            border: none;
            border-bottom: .15em solid black;
            padding: 0.65em 1.3em;
        }

        #editparent .btn-xs {
            font-size: .80em;
            padding: .25em .75em;
        }

        #editparent .btn-default {
            border-color: #d9d9d9;
            background-image: linear-gradient(#ffffff, #f2f2f2);
        }

        #editparent .btn-default:hover {
            background: linear-gradient(#f2f2f2, #e6e6e6);
        }

        #editparent a {
            color: #000;
            text-decoration: none;
            outline: 0;
        }

        #editparent a:hover {
            color: #06a0ff;
            text-decoration: none;
        }

        #editparent p {
            margin: 10px 0;
        }



        /* 
new styles
 */


        .img {
            overflow: auto;
            height: auto;
        }

        .alert {
            background-color: white;
            border: none;

        }


        /* tags */



        #inputField {
            color: #000;
        }

        .task {
            background-color: lightblue;
            width: fit-content;
            height: fit-content;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            margin: 1rem 0.5rem;
        }

        .container {
            margin: 2rem 0;
        }

        #taskname {
            padding-right: 1rem;
        }

        .delete {
            width: 1.5rem;
            height: 1.5rem;
            background-color: #000;
            color: #fff;
            border-radius: 50%;
        }
        .rendered{
            position: relative;
        }

        .delete_img{
           
            position: absolute;
    left: 17.2rem;
    top: -8.5rem;
    border: none!important;
    font-size: 16px;
    border-radius: 50%;
    background-color: #251c1c;
    text-align: center;
    line-height: 24px;
    z-index: 1;
    color: #FFF;
    cursor: pointer;
    font-weight: bold;
        }
 
    </style>
</head>

<body data-layout="horizontal" data-topbar="colored" data-layout-size="boxed">

    <!-- Begin page -->
    <div id="layout-wrapper">

        <header id="page-topbar">
            <div class="navbar-header">
                <div class="d-flex">
                    <!-- LOGO -->
                    <div class="navbar-brand-box">
                        <a href="\{{user.user_name}}/dashboard/" class="logo logo-dark">
                            <span class="logo-sm">
                                <img src="{% static 'assets/images/logo-dark.png' %}" alt="" height="68">
                            </span>
                            <span class="logo-lg">
                                <img src="{% static 'assets/images/logo-dark.png' %}" alt="" height="68">
                            </span>
                        </a>

                        <a href="\{{user.user_name}}/dashboard/" class="logo logo-light">
                            <span class="logo-sm">
                                <img src="{% static 'assets/images/logo-dark.png' %}" alt="" height="68">
                            </span>
                            <span class="logo-lg">
                                <img src="{% static 'assets/images/logo-dark.png' %}" alt="" height="68">
                            </span>
                        </a>
                    </div>

                    <button type="button"
                        class="btn btn-sm px-3 font-size-16 d-lg-none header-item waves-effect waves-light"
                        data-bs-toggle="collapse" data-bs-target="#topnav-menu-content">
                        <i class="fa fa-fw fa-bars"></i>
                    </button>

                    <!-- App Search-->

                </div>

                <div class="d-flex">

                    <div class="dropdown d-inline-block">
                        <button type="button"
                            class="btn header-item waves-effect d-flex align-items-center justify-content-center"
                            id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">
                            <img class="rounded-circle header-profile-user"
                                src="{% static 'assets/images/avatar-img.png' %}" alt="Header Avatar">
                            <span
                                class="d-none d-xl-inline-block ms-1 fw-medium font-size-15 text-white">{{user.user_name}}</span>
                            <i class="arrow-down d-none d-xl-inline-block font-size-15 text-white"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end">
                            <!-- item-->
                            <!-- <a class="dropdown-item" href="\{{user.user_name}}/changepassword/"><i class="fas fa-unlock font-size-15 align-middle text-muted me-1"></i> <span class="align-middle">Change Password</span></a>
                                -->


                            <a class="dropdown-item" href="\{{user.user_name}}/logout/"><i
                                    class="fas fa-sign-out-alt font-size-15 align-middle me-1 text-muted"></i><span
                                    class="align-middle">Sign out</span></a>
                        </div>
                    </div>



                </div>
            </div>
            <div class="container-fluid">
                <div class="topnav">
                    {% if user.is_superadmin %}
                    <nav class="navbar navbar-light navbar-expand-lg topnav-menu">

                        <div class="collapse navbar-collapse" id="topnav-menu-content">
                            <ul class="navbar-nav">

                                <li class="nav-item">
                                    <a class="nav-link" href="\{{user.user_name}}/dashboard/">
                                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                                    </a>
                                </li>



                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle arrow-none" href="#" id="topnav-pages"
                                        role="button">
                                        <i class="fas fa-stream me-2"></i>Timelines <div class="arrow-down"></div>
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="topnav-pages">


                                        <a href="\{{user.user_name}}/posts/" class="dropdown-item">
                                            <div class="arrow-right"></div>Posts
                                        </a>
                                        <a href="\{{user.user_name}}/stories/" class="dropdown-item">Stories</a>
                                        <a href="\{{user.user_name}}/banners/" class="dropdown-item">Banners</a>


                                    </div>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle arrow-none" href="#" id="topnav-pages"
                                        role="button">
                                        <i class="fas fa-walking me-2"></i>Padayatra <div class="arrow-down"></div>
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="topnav-pages">

                                        <a href="\{{user.user_name}}/schedule-padayatra/" class="dropdown-item">Schedule
                                            Padayatra</a>
                                        <a href="\{{user.user_name}}/padayatra-list/" class="dropdown-item">List of
                                            Padayatra</a>

                                    </div>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="\{{user.user_name}}/users/">
                                        <i class="fa fa-users me-2"></i> Users
                                    </a>
                                </li>

                                <li class="nav-item align-items-center" style="display:flex; ">
                                    <a class="nav-link" href="\{{user.user_name}}/connect-with-NL/"
                                        style="background: #FFED00;  padding: 6px 10px; border-radius: 50px; font-weight: 400; font-size: 14px; line-height: 12px;color: #E52A1D;">
                                        Connect with NL
                                    </a>
                                </li>

                                <li class="nav-item align-items-center" style="display:flex;margin-left:10px; ">
                                    <a class="nav-link" href="\{{user.user_name}}/live/"
                                        style="background: #FFED00;  padding: 6px 10px; border-radius: 50px; font-weight: 400; font-size: 14px; line-height: 12px;color: #E52A1D;">
                                        <i class="fab fa-youtube"></i> Live
                                    </a>
                                </li>
                                <li class="nav-item align-items-center" style="display:flex;margin-left:10px; ">
                                    <a class="nav-link" href="\{{user.user_name}}/sendnotification/">
                                        <i class="fa fa fa-bell"></i> Send Notification
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </nav>
                    {% elif user.is_manager %}
                    <nav class="navbar navbar-light navbar-expand-lg topnav-menu">

                        <div class="collapse navbar-collapse" id="topnav-menu-content">
                            <ul class="navbar-nav">

                                <li class="nav-item">
                                    <a class="nav-link" href="\{{user.user_name}}/dashboard/">
                                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                                    </a>
                                </li>



                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle arrow-none" href="#" id="topnav-pages"
                                        role="button">
                                        <i class="fas fa-stream me-2"></i>Timelines <div class="arrow-down"></div>
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="topnav-pages">


                                        <a href="\{{user.user_name}}/posts/" class="dropdown-item">
                                            <div class="arrow-right"></div>Posts
                                        </a>
                                        <a href="\{{user.user_name}}/stories/" class="dropdown-item">Stories</a>
                                        <a href="\{{user.user_name}}/banners/" class="dropdown-item">Banners</a>


                                    </div>
                                </li>
                            </ul>
                        </div>
                    </nav>
                    {% endif %}
                </div>
            </div>
        </header>



        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">




                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-3 color-red-tdp">Edit Post</h4>

                                    <form class="needs-validation" enctype="multipart/form-data">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label" for="">Title<span
                                                            style="color:red;padding-left:5px;">*</span></label>
                                                    <input type="text" class="form-control" id="title"
                                                        placeholder="Enter Title" value="">

                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label" for="">Select Category</label>
                                                    <select class="form-control " id="category"
                                                         data-placeholder="Choose ..." >
                                                         <option value="">Select a Category</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="mb-3">
                                                    <label class="form-label" for="">Title (Telugu)<span
                                                            style="color:red;padding-left:5px;">*</span></label>
                                                    <input type="text" id="telugu-title" class="form-control"
                                                        placeholder="శీర్షికను నమోదు చేయండి" value="">

                                                </div>
                                            </div>

                                        </div>

                                        <div class="row" >
                                            <div class="col-md-12" id="newtask" style="margin-bottom:1rem;" >
                                                <input  type="text" placeholder="Add Tag" class="form-control" id="inputField" />
                                            </div>
                                        </div>
                                        <div id="tasks"></div>

                                        <div class="row">

                                            <div class="col-md-12">
                                                <div class="mb-3">
                                                    <label class="form-label" for="" style="margin-top:1rem;" >Short Description</label>

                                                    <div id="editparent">
                                                        <div id="editControls">
                                                            <div class="btn-group">
                                                                <a class="btn btn-xs btn-default" data-role="undo"
                                                                    href="#" title="Undo"><i class="fa fa-undo"></i></a>
                                                                <a class="btn btn-xs btn-default" data-role="redo"
                                                                    href="#" title="Redo"><i
                                                                        class="fas fa-redo"></i></i></a>
                                                            </div>
                                                            <div class="btn-group">
                                                                <a class="btn btn-xs btn-default" data-role="bold"
                                                                    href="#" title="Bold"><i class="fa fa-bold"></i></a>
                                                                <a class="btn btn-xs btn-default" data-role="italic"
                                                                    href="#" title="Italic"><i
                                                                        class="fa fa-italic"></i></a>
                                                                <a class="btn btn-xs btn-default" data-role="underline"
                                                                    href="#" title="Underline"><i
                                                                        class="fa fa-underline"></i></a>

                                                            </div>
                                                            <div class="btn-group">

                                                                <a class="btn btn-xs btn-default"
                                                                    data-role="insertUnorderedList" href="#"
                                                                    title="Unordered List"><i
                                                                        class="fa fa-list-ul"></i></a>
                                                                <a class="btn btn-xs btn-default"
                                                                    data-role="insertOrderedList" href="#"
                                                                    title="Ordered List"><i
                                                                        class="fa fa-list-ol"></i></a>
                                                            </div>
                                                            <div class="btn-group">
                                                                <a class="btn btn-xs btn-default" data-role="h1"
                                                                    href="#" title="Heading 1"><i
                                                                        class="fas fa-heading"></i><sup>1</sup></a>
                                                                <a class="btn btn-xs btn-default" data-role="h2"
                                                                    href="#" title="Heading 2"><i
                                                                        class="fas fa-heading"></i><sup>2</sup></a>

                                                            </div>
                                                        </div>
                                                        <div id="editor" contenteditable></div>
                                                        <textarea id="editorCopy" name="desc"
                                                            style="display:none;"></textarea>
                                                    </div>

                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="mb-3">
                                                    <label class="form-label" for="">Short Description (Telugu)</label>
                                                    <textarea id="telugu-description" class="form-control p-4"
                                                        placeholder="పోస్ట్ గురించి వివరించండి"></textarea>

                                                </div>
                                            </div>

                                        </div>
                                        <div class="row">

                                            <div class="col-md-12">
                                                <div class="mb-3">
                                                    <label class="form-label" for="">Current Files</label>
                                                    <p id="currentFiles"></p>
                                                </div>
                                            </div>

                                        </div>
                                        <div class="row">

                                            <div class="col-md-12">
                                                <div class="mb-3">
                                                    <label class="form-label" for="" id="imageDescription">Upload Post
                                                        Images</label>
                                                    <div class="upload__box">
                                                        <div class="upload__btn-box">
                                                            <label class="upload__btn">
                                                                <p>Select files to upload</p>
                                                                <input type="file" multiple="" name="files" id="images"
                                                                    data-max_length="20" class="upload__inputfile">
                                                            </label>
                                                        </div>
                                                        <div class="upload__img-wrap"></div>
                                                    </div>
                                                    <p class="help-block" style="font-size: 12px; padding-top: 6px;">
                                                        Image Dimensions:(width-1080px, Height-1920px, Maximum upload
                                                        size 5MB)</p>
                                                </div>
                                            </div>

                                        </div>
                                        <div class="row">

                                            <div class="col-md-12">
                                                <div class="mb-3">
                                                    <label class="form-label" id="videoDescription" for="">Upload Post
                                                        Videos</label>
                                                    <input id="video" type="file" class="form-control" value=""
                                                        accept="video/*">
                                                    <p class="help-block" style="font-size: 12px; padding-top: 6px;">
                                                        Video Dimensions:(1080px*540px or 1920px*1080, Maximum upload
                                                        size 50MB)</p>
                                                </div>
                                            </div>

                                        </div>
                                    </form>
                                    <button class="btn mt-3 bgcolor-red-tdp text-white" type="button" b
                                        id="btn_form">Submit Post</button>

                                </div>
                            </div>
                        </div> <!-- end col -->
                    </div> <!-- end row -->


                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->


            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-12 text-center">
                            <script>document.write(new Date().getFullYear())</script> © Telugu Desam Party Padayatra.
                        </div>

                    </div>
                </div>
            </footer>
        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->




    <!-- JAVASCRIPT -->
    <script src="{% static 'assets/libs/jquery/jquery.min.js' %}"></script>
    <script src="{% static 'assets/libs/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'assets/libs/metismenu/metisMenu.min.js' %}"></script>
    <script src="{% static 'assets/libs/simplebar/simplebar.min.js' %}"></script>
    <script src="{% static 'assets/libs/node-waves/waves.min.js' %}"></script>
    <script src="{% static 'assets/libs/waypoints/lib/jquery.waypoints.min.js' %}"></script>
    <script src="{% static 'assets/libs/jquery.counterup/jquery.counterup.min.js' %}"></script>

    <!-- plugins -->
    <script src="{% static 'assets/libs/select2/js/select2.min.js' %}"></script>
    <!-- init js -->
    <script src="{% static 'assets/js/pages/form-advanced.init.js' %}"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.9/summernote-bs4.js"></script>
    <!-- App js -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tagsinput/0.8.0/bootstrap-tagsinput.min.js"></script>



    <script src="{% static 'assets/js/app.js' %}"></script>

    <script>
        $(function () {
            $('input')
                .on('change', function (event) {
                    var $element = $(event.target);
                    var $container = $element.closest('.example');

                    if (!$element.data('tagsinput')) return;

                    var val = $element.val();
                    if (val === null) val = 'null';
                    var items = $element.tagsinput('items');

                    $('code', $('pre.val', $container)).html(
                        $.isArray(val)
                            ? JSON.stringify(val)
                            : '"' + val.replace('"', '\\"') + '"'
                    );
                    $('code', $('pre.items', $container)).html(
                        JSON.stringify($element.tagsinput('items'))
                    );
                })
                .trigger('change');
        });
    </script>

    <script>
        console.log($('#inputField'))
        $('#inputField').on('keydown', function (e) {
            if (e.key == 'Enter') {
                e.preventDefault()
                $('#tasks').append(`<span class="task"><span id="taskname">${e.target.value}</span><button class="delete">X</button></span>`);
                console.log('========================')



                // console.log($('#taskname')[0].innerHTML)
                e.target.value = '';

                var current_tasks = $(".delete")
                for (var i = 0; i < current_tasks.length; i++) {
                    current_tasks[i].onclick = function () {
                        this.parentNode.remove();
                    };
                }
            }
        }
        )

// $('#btn_form').on('click',function(e){ 
//     alert('button clicked')
//             for(var i=0;i<$('#tasks')[0].children.length;i++){
//                 console.log($('#tasks')[0].children[i].firstChild.innerHTML)
//              }
//         })




    </script>









    <script>
        jQuery(document).ready(function ($) {
            /** ******************************
                * Simple WYSIWYG
                ****************************** **/
            $('#editControls a').click(function (e) {
                e.preventDefault();
                switch ($(this).data('role')) {
                    case 'h1':
                    case 'h2':
                    case 'h3':
                    case 'p':
                        document.execCommand('formatBlock', false, $(this).data('role'));
                        break;
                    default:
                        document.execCommand($(this).data('role'), false, null);
                        break;
                }
                var textval = $("#editor").html();
                $("#editorCopy").val(textval);
            });

            $("#editor").keyup(function () {
                var value = $(this).html();
                $("#editorCopy").val(value);
            }).keyup();

            $('#checkIt').click(function (e) {
                e.preventDefault();
                alert($("#editorCopy").val());
            });
        });
    </script>


    <script>
        const cName = "{{user.user_name}}"
        function getCookie(cName) {
            const name = cName + "=";
            const cDecoded = decodeURIComponent(document.cookie); //to be careful
            const cArr = cDecoded.split('; ');
            let res;
            cArr.forEach(val => {
                if (val.indexOf(name) === 0) res = val.substring(name.length);
            })
            return res;
        }
        const cookie = getCookie(cName)
        let id;
        let posttype
        if (cookie == undefined) {
            window.location.href = 'https://tdp.yuvagalamapp.com/'
        } else {
            id = "{{id}}"
            getCurrentPost(id)
        }
        async function getCurrentPost(post_id) {
            await fetch(`https://tdp.yuvagalamapp.com/feed/get-post/${post_id}`, {
                headers: {
                    'Content-Type': "application/json",
                    "Authorization": `Bearer ${cookie}`
                },
            })
                .then(response => {
                    if (response.ok) {
                        return response.json()
                    } else if (response.status == 401) {
                        window.location.href = 'https://tdp.yuvagalamapp.com/'
                    }
                })
                .then(data => {
                    let post = data.data[0]
                    posttype = post.post_type
                    console.log(post)
                    $('#title').val(post.title_english)
                    $('#telugu-title').val(post.title_telugu)
                console.log($('#category'))
                    let allcats=['Fans','NL Yatra', 'Exclusive']
                    allcats.forEach(ele=>{
                        if(post.category==ele){
                            $('#category').append(`<option selected>${ele}</option>`)
                        }else{
                            $('#category').append(`<option >${ele}</option>`)
                        }

                    })
                    // <span class="tag label label-info">kjn<span data-role="remove"></span></span>
                    let currentTags = post.tags.split(',')
                    currentTags.forEach(ele => {
                        console.log(ele)
                        $('#tasks').append(`<span class="task"><span id="taskname" style="display:inline-block;margin-bottom:1rem;">${ele}</span><button class="delete" >X</button></span>`);
                        var current_tasks = $(".delete")
                        for (var i = 0; i < current_tasks.length; i++) {
                            current_tasks[i].onclick = function () {
                                this.parentNode.remove();
                            };
                        }
                    })


                    $('#editor').append(post.description_english)
                    $('#telugu-description').val(post.description_telugu)
                    if (post.post_type == 'IMAGE') {
                        post.source_link.forEach(ele => {
                            let source = ele
                            // $('#currentFiles').append(`<span><img width="300px" height="300px" id="oldimage" src=${ele}><button class="delete_img" style="position: absolute;left: 17.5rem;top: 2rem; border: none!important;font-size: 16px;border-radius: 50%;background-color: #251c1c;color: #FFF;cursor: pointer;font-weight:bold;">X</button></span>`)
                            $('#currentFiles').append(`<span class="rendered"><img width="300px" height="300px" id="oldimage"  src=${ele}><button class="delete_img" >X</button></span>`)
                            var current_img = $(".delete_img")
                            for (var i = 0; i < current_img.length; i++) {
                                current_img[i].onclick = function () {
                                    this.parentNode.remove();
                                };
                            }
                        })


                    } else {
                        $('#currentFiles').append(`<p><video src=${post.source_link} width="720px" height="480px" controls></video></p>`)
                    }

                })
        }

        jQuery(document).ready(function () {
            ImgUpload();
        });
        let uploadedFiles = [];
        function ImgUpload() {
            var imgWrap = "";
            var imgArray = [];

            $('.upload__inputfile').each(function () {

                $(this).on('change', function (e) {

                    imgWrap = $(this).closest('.upload__box').find('.upload__img-wrap');
                    var maxLength = $(this).attr('data-max_length');

                    var files = e.target.files;
                    var filesArr = Array.prototype.slice.call(files);
                    var iterator = 0;
                    filesArr.forEach(function (f, index) {
                        if (!f.type.match('image.*')) {
                            return;
                        }

                        if (imgArray.length > maxLength) {
                            return false
                        } else {
                            var len = 0;
                            for (var i = 0; i < imgArray.length; i++) {
                                if (imgArray[i] !== undefined) {
                                    len++;
                                }
                            }
                            if (len > maxLength) {
                                return false;
                            } else {
                                var reader = new FileReader();
                                reader.onload = function (e) {
                                    var html = "<div class='upload__img-box'><div style='background-image: url(" + e.target.result + ")' data-number='" + $(".upload__img-close").length + "' data-file='" + f.name + "' class='img-bg'><div class='upload__img-close'></div></div></div>";
                                    imgWrap.append(html);
                                    iterator++;
                                    const img = new Image()
                                    img.src = reader.result
                                    img.onload = function () {
                                        if (img.height == img.width) {
                                            const files = {
                                                file_extension: reader.result.split(',')[0].split(';')[0].split('/')[1],
                                                file_type: reader.result.split(',')[0].split(';')[0].split('/')[0].split(':')[1].toUpperCase(),
                                                data: reader.result.split(',')[1],
                                            }
                                            if (files.file_type == 'IMAGE') {
                                                $('#imageDescription').append(`<p class="text-success">Image is Valid..</p>`)
                                                imgArray.push(f);
                                                uploadedFiles.push(files)
                                                posttype = 'IMAGE'
                                            } else {
                                                $('#imageDescription').append(`<p class="text-info">Please Upload Only Images..</p>`)
                                            }
                                        } else {
                                            $('#imageDescription').append(`<p class="text-danger">Enter Image With Dimensions 1920*1080</p>`)
                                        }
                                    }
                                }
                                reader.readAsDataURL(f);
                            }
                        }
                    });
                });
            });



            $('body').on('click', ".upload__img-close", function (e) {

                var file = $(this).parent().data("file");
                for (var i = 0; i < imgArray.length; i++) {
                    if (imgArray[i].name === file) {
                        imgArray.splice(i, 1);
                        uploadedFiles.splice(i, 1)
                        break;
                    }
                }
                $(this).parent().parent().remove();

            });
        }
        $('#video').on('change', function (e) {
            if (uploadedFiles.length == 0) {
                const video = e.target.files[0]
                if (video.size < 52428800) {
                    const reader = new FileReader()
                    reader.onload = function () {
                        const files = {
                            file_extension: reader.result.split(',')[0].split(';')[0].split('/')[1],
                            file_type: reader.result.split(',')[0].split(';')[0].split('/')[0].split(':')[1].toUpperCase(),
                            data: reader.result.split(',')[1],
                        }
                        if (files.file_type == 'VIDEO') {
                            $('#videoDescription').append(`<p class="text-success">Video is Valid..</p>`)
                            uploadedFiles.push(files)
                            posttype = 'VIDEO'
                        }
                    }

                    reader.readAsDataURL(video)
                } else {
                    $('#videoDescription').append(`<p class="text-danger">Video is inValid.. Video must be lessthan 50mb</p>`)

                }
            } else {
                $('#videoDescription').append(`<p class="text-danger">Cannot Upload both Video and Image</p>`)

            }
        })
        let current_urls = [];
        $('#btn_form').on('click', function (e) {
            current_urls = []
            alert("clicked")
            console.log($('#currentFiles')[0].children[0])
            for (var i = 0; i < $('#currentFiles')[0].childElementCount; i++) {
                current_urls.push($('#currentFiles')[0].children[i].firstChild.src)
            }
            console.log(current_urls)
            e.preventDefault()
            let files = uploadedFiles
            uploadfile(files)
        })

        async function uploadfile(files) {
            alert("in files")
            console.log("in files==============")
            console.log(current_urls)
            const FileData = {
                files: files
            }
            await fetch('https://tdp.yuvagalamapp.com/feed/upload', {
                method: 'post',
                headers: {
                    'Content-Type': 'application/json',
                    "Authorization": `Bearer ${cookie}`,
                },
                body: JSON.stringify(FileData)
            })
                .then(response => {
                    if (response.ok) {
                        return response.json()
                    } else if (response.status == 401) {
                        window.location.href = 'https://tdp.yuvagalamapp.com/'
                    }
                })
                .then(data => {
                    let urls = data.data.join(',')
                    let old_urls = current_urls.join(',')

                    if (urls.length > 0 & old_urls.length > 0) {
                        urls += ','
                    }
                    // let new_cu = urls.join(',')
                    // console.log(new_cu)
                    let allnew = urls.concat(old_urls)
                    console.log(allnew)
                    postData(allnew)
                })
        }
        async function postData(urls) {
            alert(posttype)
            console.log("in postss====================")
            console.log(urls)
            if ($('#title').val().trim() == '') {
                alert('Title Is Required')
                window.location.href = '#title'
            } else if ($('#category').val() == '') {
                window.location.href = '#category'
            } else if ($('#tasks')[0].children.length == 0) {
                alert('tags Is Required')
            } else if ($('#editor').html() == '') {
                alert('english Is Required')
            } else if ($('#telugu-description').val() == '') {
                alert('telugu Is Required')

            } else if (posttype == 'IMAGE' || posttype == 'VIDEO' || posttype == 'TEXT') {
                let tags = [];
                for (var i = 0; i < $('#tasks')[0].children.length; i++) {
                    tags.push($('#tasks')[0].children[i].firstChild.innerHTML)
                }
                let data = JSON.stringify({
                    id: Number.parseInt(id),
                    title_english: $('#title').val(),
                    title_telugu: $('#telugu-title').val(),
                    category: $('#category').val().join(','),
                    tags: tags.join(','),
                    description_english: $('#editor').html(),
                    description_telugu: $('#telugu-description').val(),
                    post_type: posttype,
                    source_link: urls,
                    user_id: 1,
                    published: false
                })
                await fetch('https://tdp.yuvagalamapp.com/feed/update-post', {
                    method: 'put',
                    headers: {
                        'Content-Type': 'application/json',
                        "Authorization": `Bearer ${cookie}`,
                    },
                    body: data
                }).then(response => {
                    if (response.ok) {
                        // window.location.href='https://tdp.yuvagalamapp.com/{{user.user_name}}/posts/'

                        return response.json()
                    } else if (response.status == 401) {
                        window.location.href = 'https://tdp.yuvagalamapp.com/'
                    }
                })
                    .then(data => {
                        // console.log(data
                    })
            }
        }

    </script>

    <script>

        async function srcToFile(e, context, asset) {
            const files = e.target.files.fileList;
            let results = [];
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const data = file.data;
                const name = file.name;
                const mimeType = file.type;

                await fetch(data)
                    .then(function (res) {
                        const r = res.arrayBuffer();
                        console.warn('resource ', r);
                        return r;
                    })
                    .then(function (buf) {
                        console.warn('buffer: ', [buf]);
                        const fileData = { data: [buf], name: name, type: mimeType };
                        results.push(fileData);
                        console.warn('results of file: ', fileData);
                    });
            }
            console.warn(results);
            return results;
        }


    </script>
</body>

</html>