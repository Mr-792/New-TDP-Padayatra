{% load static %}
<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8" />
    <title>TDP | Padayatra</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description" />
    <meta content="Themesbrand" name="author" />
    <!-- App favicon -->
    <link rel="shortcut icon" href="{% static 'assets/images/logo-dark.png' %}">

    <!-- Bootstrap Css -->
    <link href="{% static 'assets/css/bootstrap.min.css' %}" id="bootstrap-style" rel="stylesheet" type="text/css" />
    <!-- Icons Css -->
    <link href="{% static 'assets/css/icons.min.css' %}" rel="stylesheet" type="text/css" />
    <!-- App Css-->
    <link href="{% static 'assets/css/app.min.css' %}" id="app-style" rel="stylesheet" type="text/css" />
    <link href="{% static 'assets/libs/select2/css/select2.min.css' %}" rel="stylesheet" type="text/css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tagsinput/0.8.0/bootstrap-tagsinput.css"
        rel="stylesheet" />
    <style>
        #editor {
            resize: vertical;
            overflow: auto;
            line-height: 1.5;
            background-color: #fff;
            background-image: none;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            min-height: 150px;
            box-shadow: none;
            padding: 8px 16px;
            margin: 0 auto;
            font-size: 14px;
            transition: border-color 0.15s ease-in-out 0s, box-shadow 0.15s ease-in-out 0s;
        }

        #editor:focus {
            background-color: #f0f0f0;
            border-color: #38af5b;
            box-shadow: none;
            outline: 0 none;
        }

        .title h1,
        .title h2,
        .title h3,
        .title h4 {
            margin: 5px;
        }

        .title {
            position: relative;
            display: block;
            padding-bottom: 0;
            border-bottom: 3px double #dcdcdc;
            margin-bottom: 30px;
        }

        .title::before {
            width: 15%;
            height: 3px;
            background: #53bdff;
            position: absolute;
            bottom: -3px;
            content: '';
        }

        #editparent .btn {
            font-family: "Raleway", sans-serif;
            font-weight: 300;
            font-size: 1em;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            border: none;
            border-bottom: .15em solid black;
            padding: 0.65em 1.3em;
        }

        #editparent .btn-xs {
            font-size: .80em;
            padding: .25em .75em;
        }

        #editparent .btn-default {
            border-color: #d9d9d9;
            background-image: linear-gradient(#ffffff, #f2f2f2);
        }

        #editparent .btn-default:hover {
            background: linear-gradient(#f2f2f2, #e6e6e6);
        }

        #editparent a {
            color: #000;
            text-decoration: none;
            outline: 0;
        }

        #editparent a:hover {
            color: #06a0ff;
            text-decoration: none;
        }

        #editparent p {
            margin: 10px 0;
        }


        /* tags */
        #inputField {
            color: #000;
        }

        .task {
            background-color: lightblue;
            width: fit-content;
            height: fit-content;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            margin: 1rem 0.5rem;
        }

        /* .container {
            margin: 2rem 0;
        } */

        #taskname {
            padding-right: 1rem;
        }

        .delete {
            width: 1.5rem;
            height: 1.5rem;
            background-color: #000;
            color: #fff;
            border-radius: 50%;
        }
    </style>
</head>

<body data-layout="horizontal" data-topbar="colored" data-layout-size="boxed">

    <!-- Begin page -->
    <div id="layout-wrapper">

        <header id="page-topbar">
            <div class="navbar-header">
                <div class="d-flex">
                    <!-- LOGO -->
                    <div class="navbar-brand-box">
                        <a href="\{{user.user_name}}/dashboard/" class="logo logo-dark">
                            <span class="logo-sm">
                                <img src="{% static 'assets/images/logo-dark.png' %}" alt="" height="68">
                            </span>
                            <span class="logo-lg">
                                <img src="{% static 'assets/images/logo-dark.png' %}" alt="" height="68">
                            </span>
                        </a>

                        <a href="\{{user.user_name}}/dashboard/" class="logo logo-light">
                            <span class="logo-sm">
                                <img src="{% static 'assets/images/logo-dark.png' %}" alt="" height="68">
                            </span>
                            <span class="logo-lg">
                                <img src="{% static 'assets/images/logo-dark.png' %}" alt="" height="68">
                            </span>
                        </a>
                    </div>

                    <button type="button"
                        class="btn btn-sm px-3 font-size-16 d-lg-none header-item waves-effect waves-light"
                        data-bs-toggle="collapse" data-bs-target="#topnav-menu-content">
                        <i class="fa fa-fw fa-bars"></i>
                    </button>


                </div>

                <div class="d-flex">






                    <div class="dropdown d-inline-block">
                        <button type="button"
                            class="btn header-item waves-effect d-flex align-items-center justify-content-center"
                            id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">
                            <img class="rounded-circle header-profile-user"
                                src="{% static 'assets/images/avatar-img.png' %}" alt="Header Avatar">
                            <span
                                class="d-none d-xl-inline-block ms-1 fw-medium font-size-15 text-white">{{iuser.user_name}}</span>
                            <i class="arrow-down d-none d-xl-inline-block font-size-15 text-white"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end">
                            <!-- item-->
                            <!-- <a class="dropdown-item" href="\{{user.user_name}}/changepassword/"><i class="fas fa-unlock font-size-15 align-middle text-muted me-1"></i> <span class="align-middle">Change Password</span></a>
                                -->


                            <a class="dropdown-item" href="\{{user.user_name}}/logout/"><i
                                    class="fas fa-sign-out-alt font-size-15 align-middle me-1 text-muted"></i><span
                                    class="align-middle">Sign out</span></a>
                        </div>
                    </div>



                </div>
            </div>
            <div class="container-fluid">
                <div class="topnav">
                    {% if user.is_superadmin %}
                    <nav class="navbar navbar-light navbar-expand-lg topnav-menu">

                        <div class="collapse navbar-collapse" id="topnav-menu-content">
                            <ul class="navbar-nav">

                                <li class="nav-item">
                                    <a class="nav-link" href="\{{user.user_name}}/dashboard/">
                                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                                    </a>
                                </li>



                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle arrow-none" href="#" id="topnav-pages"
                                        role="button">
                                        <i class="fas fa-stream me-2"></i>Timelines <div class="arrow-down"></div>
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="topnav-pages">


                                        <a href="\{{user.user_name}}/posts/" class="dropdown-item">
                                            <div class="arrow-right"></div>Posts
                                        </a>
                                        <a href="\{{user.user_name}}/stories/" class="dropdown-item">Stories</a>
                                        <a href="\{{user.user_name}}/banners/" class="dropdown-item">Banners</a>


                                    </div>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle arrow-none" href="#" id="topnav-pages"
                                        role="button">
                                        <i class="fas fa-walking me-2"></i>Padayatra <div class="arrow-down"></div>
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="topnav-pages">

                                        <a href="\{{user.user_name}}/schedule-padayatra/" class="dropdown-item">Schedule
                                            Padayatra</a>
                                        <a href="\{{user.user_name}}/padayatra-list/" class="dropdown-item">List of
                                            Padayatra</a>

                                    </div>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="\{{user.user_name}}/users/">
                                        <i class="fa fa-users me-2"></i> Users
                                    </a>
                                </li>

                                <li class="nav-item align-items-center" style="display:flex; ">
                                    <a class="nav-link" href="\{{user.user_name}}/connect-with-NL/"
                                        style="background: #FFED00;  padding: 6px 10px; border-radius: 50px; font-weight: 400; font-size: 14px; line-height: 12px;color: #E52A1D;">
                                        Connect with NL
                                    </a>
                                </li>

                                <li class="nav-item align-items-center" style="display:flex;margin-left:10px; ">
                                    <a class="nav-link" href="\{{user.user_name}}/live/"
                                        style="background: #FFED00;  padding: 6px 10px; border-radius: 50px; font-weight: 400; font-size: 14px; line-height: 12px;color: #E52A1D;">
                                        <i class="fab fa-youtube"></i> Live
                                    </a>
                                </li>
                                <li class="nav-item align-items-center" style="display:flex;margin-left:10px; ">
                                    <a class="nav-link" href="\{{user.user_name}}/sendnotification/">
                                        <i class="fa fa fa-bell"></i> Send Notification
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </nav>
                    {% elif user.is_manager %}
                    <nav class="navbar navbar-light navbar-expand-lg topnav-menu">

                        <div class="collapse navbar-collapse" id="topnav-menu-content">
                            <ul class="navbar-nav">

                                <li class="nav-item">
                                    <a class="nav-link" href="\{{user.user_name}}/dashboard/">
                                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                                    </a>
                                </li>



                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle arrow-none" href="#" id="topnav-pages"
                                        role="button">
                                        <i class="fas fa-stream me-2"></i>Timelines <div class="arrow-down"></div>
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="topnav-pages">


                                        <a href="\{{user.user_name}}/posts/" class="dropdown-item">
                                            <div class="arrow-right"></div>Posts
                                        </a>
                                        <a href="\{{user.user_name}}/stories/" class="dropdown-item">Stories</a>
                                        <a href="\{{user.user_name}}/banners/" class="dropdown-item">Banners</a>


                                    </div>
                                </li>
                            </ul>
                        </div>
                    </nav>
                    {% endif %}
                </div>
            </div>
        </header>



        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">




                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-3 color-red-tdp">Add Posts</h4>

                                    <form class="needs-validation" name="myForm" enctype="multipart/form-data">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label" for="">Title<span
                                                            style="color:red;padding-left:5px;">*</span></label>
                                                    <input type="text" class="form-control" id="title" name="title"
                                                        placeholder="Enter Title" value="">

                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label" for="">Select Category</label>
                                                    <select class="form-control" id="category">
                                                        <option value="" class="default-select">Select a category
                                                        </option>
                                                        <option value="FANS">Fans</option>
                                                        <option value="NL Yatra">NL Yatra</option>
                                                        <option value="Exclusive">Exclusive</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="mb-3">
                                                    <label class="form-label" for="">Title (Telugu)<span
                                                            style="color:red;padding-left:5px;">*</span></label>
                                                    <input type="text" id="telugu-title" class="form-control"
                                                        placeholder="శీర్షికను నమోదు చేయండి" value="">

                                                </div>
                                            </div>

                                        </div>

                                        <div class="row mb-2">
                                            <div class="col-md-12" id="newtask">
                                                <div class="mb-3">
                                                <input type="text" placeholder="Add Tag" class="form-control" id="inputField" />
                                                </div>
                                            </div>
                                        </div>
                                        <div id="tasks"></div>


                                        <div class="row">

                                            <div class="col-md-12">
                                                <div class="mb-3">
                                                    <label class="form-label" for="">Short Description</label>

                                                    <div id="editparent">
                                                        <div id="editControls">
                                                            <div class="btn-group">
                                                                <a class="btn btn-xs btn-default" data-role="undo"
                                                                    href="#" title="Undo"><i class="fa fa-undo"></i></a>
                                                                <a class="btn btn-xs btn-default" data-role="redo"
                                                                    href="#" title="Redo"><i
                                                                        class="fas fa-redo"></i></i></a>
                                                            </div>
                                                            <div class="btn-group">
                                                                <a class="btn btn-xs btn-default" data-role="bold"
                                                                    href="#" title="Bold"><i class="fa fa-bold"></i></a>
                                                                <a class="btn btn-xs btn-default" data-role="italic"
                                                                    href="#" title="Italic"><i
                                                                        class="fa fa-italic"></i></a>
                                                                <a class="btn btn-xs btn-default" data-role="underline"
                                                                    href="#" title="Underline"><i
                                                                        class="fa fa-underline"></i></a>

                                                            </div>
                                                            <div class="btn-group">

                                                                <a class="btn btn-xs btn-default"
                                                                    data-role="insertUnorderedList" href="#"
                                                                    title="Unordered List"><i
                                                                        class="fa fa-list-ul"></i></a>
                                                                <a class="btn btn-xs btn-default"
                                                                    data-role="insertOrderedList" href="#"
                                                                    title="Ordered List"><i
                                                                        class="fa fa-list-ol"></i></a>
                                                            </div>
                                                            <div class="btn-group">
                                                                <a class="btn btn-xs btn-default" data-role="h1"
                                                                    href="#" title="Heading 1"><i
                                                                        class="fas fa-heading"></i><sup>1</sup></a>
                                                                <a class="btn btn-xs btn-default" data-role="h2"
                                                                    href="#" title="Heading 2"><i
                                                                        class="fas fa-heading"></i><sup>2</sup></a>

                                                            </div>
                                                        </div>
                                                        <div id="editor" contenteditable></div>
                                                        <textarea id="editorCopy" name="desc"
                                                            style="display:none;"></textarea>
                                                    </div>

                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="mb-3">
                                                    <label class="form-label" for="">Short Description (Telugu)</label>
                                                    <textarea id="telugu-description" class="form-control p-4"
                                                        placeholder="పోస్ట్ గురించి వివరించండి"></textarea>

                                                </div>
                                            </div>

                                        </div>
                                        <div class="row">

                                            <div class="col-md-12">
                                                <div class="mb-3">
                                                    <label class="form-label" for="" id="imageDescription">Upload Post
                                                        Images</label>
                                                    <div class="upload__box">
                                                        <div class="upload__btn-box">
                                                            <label class="upload__btn">
                                                                <p>Select files to upload</p>
                                                                <input type="file" multiple="" name="files" id="images"
                                                                    data-max_length="20" class="upload__inputfile">
                                                            </label>
                                                        </div>
                                                        <div class="upload__img-wrap"></div>
                                                    </div>
                                                    <p class="help-block" style="font-size: 12px; padding-top: 6px;">
                                                        Image Dimensions:(width-400px, Height-400px, Maximum upload size
                                                        5MB)</p>
                                                </div>
                                            </div>

                                        </div>
                                        <div class="row">

                                            <div class="col-md-12">
                                                <div class="mb-3">
                                                    <label class="form-label" id="videoDescription" for="">Upload Post
                                                        Videos</label>
                                                    <input id="video" type="file" class="form-control" value=""
                                                        accept="video/*">
                                                    <p class="help-block" style="font-size: 12px; padding-top: 6px;">
                                                        Video Dimensions:(Width=800px,Height=450px, Maximum upload size
                                                        50MB)</p>
                                                </div>
                                            </div>

                                        </div>
                                    </form>
                                    <button class="btn mt-3 bgcolor-red-tdp text-white" id="btn_form">Submit
                                        Post</button>

                                </div>
                            </div>
                        </div> <!-- end col -->
                    </div> <!-- end row -->


                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->


            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-12 text-center">
                            <script>document.write(new Date().getFullYear())</script> © Telugu Desam Party Padayatra.
                        </div>

                    </div>
                </div>
            </footer>
        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->





    <!-- JAVASCRIPT -->
    <script src="{% static 'assets/libs/jquery/jquery.min.js' %}"></script>
    <script src="{% static 'assets/libs/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'assets/libs/metismenu/metisMenu.min.js' %}"></script>
    <script src="{% static 'assets/libs/simplebar/simplebar.min.js' %}"></script>
    <script src="{% static 'assets/libs/node-waves/waves.min.js' %}"></script>
    <script src="{% static 'assets/libs/waypoints/lib/jquery.waypoints.min.js' %}"></script>
    <script src="{% static 'assets/libs/jquery.counterup/jquery.counterup.min.js' %}"></script>

    <!-- plugins -->
    <script src="{% static 'assets/libs/select2/js/select2.min.js' %}"></script>
    <!-- init js -->
    <script src="{% static 'assets/js/pages/form-advanced.init.js' %}"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.9/summernote-bs4.js"></script>
    <!-- App js -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tagsinput/0.8.0/bootstrap-tagsinput.min.js"></script>



    <script src="{% static 'assets/js/app.js' %}"></script>

    <script>
        $(function () {
            $('input')
                .on('change', function (event) {
                    var $element = $(event.target);
                    var $container = $element.closest('.example');

                    if (!$element.data('tagsinput')) return;

                    var val = $element.val();
                    if (val === null) val = 'null';
                    var items = $element.tagsinput('items');

                    $('code', $('pre.val', $container)).html(
                        $.isArray(val)
                            ? JSON.stringify(val)
                            : '"' + val.replace('"', '\\"') + '"'
                    );
                    $('code', $('pre.items', $container)).html(
                        JSON.stringify($element.tagsinput('items'))
                    );
                })
                .trigger('change');
        });
    </script>

    <script>
        console.log($('#inputField'))
        $('#inputField').on('keydown', function (e) {
            if (e.key == 'Enter') {
                e.preventDefault()
                $('#tasks').append(`<span class="task"><span id="taskname">${e.target.value}</span><button class="delete">X</button></span>`);
                e.target.value = '';
                var current_tasks = $(".delete")
                for (var i = 0; i < current_tasks.length; i++) {
                    console.log(current_tasks[i])
                    current_tasks[i].onclick = function () {
                        this.parentNode.remove();
                    };
                }
            }
        }
        )
    </script>
    <script>
        const cName = "{{user.user_name}}"
        function getCookie(cName) {
            const name = cName + "=";
            const cDecoded = decodeURIComponent(document.cookie); //to be careful
            const cArr = cDecoded.split('; ');
            let res;
            cArr.forEach(val => {
                if (val.indexOf(name) === 0) res = val.substring(name.length);
            })
            return res;
        }
        const cookie = getCookie(cName)
        if (cookie == undefined) {
            window.location.href = 'https://tdp.yuvagalamapp.com/'
        }
        jQuery(document).ready(function ($) {
            /** ******************************
                * Simple WYSIWYG
                ****************************** **/
            $('#editControls a').click(function (e) {
                e.preventDefault();
                switch ($(this).data('role')) {
                    case 'h1':
                    case 'h2':
                    case 'h3':
                    case 'p':
                        document.execCommand('formatBlock', false, $(this).data('role'));
                        break;
                    default:
                        document.execCommand($(this).data('role'), false, null);
                        break;
                }
                var textval = $("#editor").html();
                $("#editorCopy").val(textval);
            });

            $("#editor").keyup(function () {
                var value = $(this).html();
                $("#editorCopy").val(value);
            }).keyup();

            $('#checkIt').click(function (e) {
                e.preventDefault();
                alert($("#editorCopy").val());
            });
        });
    </script>
    <script>


        jQuery(document).ready(function () {
            ImgUpload();
        });
        let uploadedFiles = [];
        function ImgUpload() {
            var imgWrap = "";
            var imgArray = [];

            $('.upload__inputfile').each(function () {

                $(this).on('change', function (e) {

                    imgWrap = $(this).closest('.upload__box').find('.upload__img-wrap');
                    var maxLength = $(this).attr('data-max_length');

                    var files = e.target.files;
                    var filesArr = Array.prototype.slice.call(files);
                    var iterator = 0;
                    filesArr.forEach(function (f, index) {
                        if (!f.type.match('image.*')) {
                            return;
                        }

                        if (imgArray.length > maxLength) {
                            return false
                        } else {
                            var len = 0;
                            for (var i = 0; i < imgArray.length; i++) {
                                if (imgArray[i] !== undefined) {
                                    len++;
                                }
                            }
                            if (len > maxLength) {
                                return false;
                            } else {


                                var reader = new FileReader();
                                reader.onload = function (e) {
                                    var html = "<div class='upload__img-box'><div style='background-image: url(" + e.target.result + ")' data-number='" + $(".upload__img-close").length + "' data-file='" + f.name + "' class='img-bg'><div class='upload__img-close'></div></div></div>";
                                    imgWrap.append(html);
                                    iterator++;
                                    const img = new Image()
                                    img.src = reader.result
                                    img.onload = function () {
                                        if (img.height == img.width) {
                                            const files = {
                                                file_extension: reader.result.split(',')[0].split(';')[0].split('/')[1],
                                                file_type: reader.result.split(',')[0].split(';')[0].split('/')[0].split(':')[1].toUpperCase(),
                                                data: reader.result.split(',')[1],
                                            }
                                            if (files.file_type == 'IMAGE') {
                                                $('#imageDescription').append(`<p class="text-success">Image is Valid..</p>`)
                                                imgArray.push(f);
                                                uploadedFiles.push(files)
                                                posttype = 'IMAGE'
                                            } else {
                                                $('#imageDescription').append(`<p class="text-info">Please Upload Only Images..</p>`)
                                            }
                                        } else {
                                            $('#imageDescription').append(`<p class="text-danger">Enter Image With Dimensions 1920*1080</p>`)
                                        }
                                    }
                                }
                                reader.readAsDataURL(f);
                            }
                        }
                    });
                });
            });



            $('body').on('click', ".upload__img-close", function (e) {

                var file = $(this).parent().data("file");
                for (var i = 0; i < imgArray.length; i++) {
                    if (imgArray[i].name === file) {
                        imgArray.splice(i, 1);
                        uploadedFiles.splice(i, 1)
                        break;
                    }
                }
                $(this).parent().parent().remove();

            });
        }



        $('#video').on('change', function (e) {
            $('#videoDescription').empty()

            if (uploadedFiles.length == 0) {
                const video = e.target.files[0]
                if (video.size < 15428800) {
                    let reader = new FileReader();
                    reader.onload = function (e) {
                        var dataUrl = reader.result;
                        var videoId = "videoMain";
                        var $videoEl = $('<video id="' + videoId + '"></video>');
                        $videoEl.attr('src', dataUrl)
                        const videoTag = $videoEl[0]
                        videoTag.onloadedmetadata = function (e) {
                            let x = videoTag.videoWidth / videoTag.videoHeight
                            let y = 16 / 9
                            if (x === y) {
                                const files = {
                                    file_extension: reader.result.split(',')[0].split(';')[0].split('/')[1],
                                    file_type: reader.result.split(',')[0].split(';')[0].split('/')[0].split(':')[1].toUpperCase(),
                                    data: reader.result.split(',')[1],
                                }
                                uploadedFiles.push(files)
                                posttype = 'VIDEO'
                                $('#videoDescription').append(`<p class="text-success">Video is Valid..</p>`)
                            } else {
                                $('#videoDescription').append(`<p class="text-danger">Video is of InValid Dimensions Upload(16:9)aspect ratio..</p>`)
                            }
                        }
                    }
                    reader.readAsDataURL(video);

                } else {
                    $('#videoDescription').append(`<p class="text-danger">Video is inValid.. Video must be lessthan 50mb</p>`)

                }
            } else {
                $('#videoDescription').append(`<p class="text-danger">Cannot Upload both Video and Image To upload a Video please Refresh the page and StartOver</p>`)

            }
        })





        function validateform() {
            if ($('#title').val().trim() == '') {
                $('#title').focus()
                // alert('Title Cannot be empty')
                return false;
            } else if ($('#category').val() == '') {
                $('#category').focus()
                return false;

            } else if ($('#telugu-title').val().trim() == '') {
                $('#telugu-title').focus()
                return false;

            } else if ($('#tasks')[0].children.length == 0) {
                $('#inputField').focus()
                return false;

            } else if ($('#editor').html() == '') {
                $('#editor').focus()
                return false;

            } else if ($('#telugu-description').val().trim() == '') {
                $('#telugu-description').focus()
                return false;
            } else {
                return true
            }
        }

        $('#btn_form').on('click', function (e) {
            e.preventDefault()
            let files = uploadedFiles
            uploadfile(files)
        })

        async function uploadfile(files) {
            let state = validateform()
            if (state) {
                alert(state)
                if (files.length == 0) {
                    alert("zero")
                    let state = confirm("Are you sure ,Do you want to create a TEXT post")
                    if (state) {
                        posttype = 'TEXT'
                        urls = ''
                        postData(urls)
                    } else {
                        return
                    }
                } else {
                    const FileData = {
                        files: files
                    }
                    alert(posttype)
                    await fetch('https://tdp.yuvagalamapp.com/feed/upload', {
                        method: 'post',
                        headers: {
                            'Content-Type': 'application/json',
                            "Authorization": `Bearer ${cookie}`,
                        },
                        body: JSON.stringify(FileData)
                    })
                        .then(response => {
                            if (response.ok) {
                                return response.json()
                            } else if (response.status == 401) {
                                window.location.href = 'https://tdp.yuvagalamapp.com/'
                            }
                        })
                        .then(data => {
                            let urls = data.data.join(',')
                            postData(urls)
                        }).catch(error => {
                            console.log(error)
                        })
                }
            }
        }



        async function postData(urls) {
            alert(posttype)

            let tags = [];
            for (var i = 0; i < $('#tasks')[0].children.length; i++) {
                tags.push($('#tasks')[0].children[i].firstChild.innerHTML)
            }

            let data_post = {
                title_english: $('#title').val(),
                title_telugu: $('#telugu-title').val(),
                category: ($('#category').val()),
                tags: tags.join(','),
                description_english: $('#editorCopy').val(),
                description_telugu: $('#telugu-description').val(),
                post_type: posttype,
                source_link: urls,
                user_id: 1,
            }
            createpost(data_post)

        }

        async function createpost(post) {
            await fetch('https://tdp.yuvagalamapp.com/feed/create-post', {
                method: 'post',
                headers:{
                    'Content-Type': 'application/json',
                            "Authorization": `Bearer ${cookie}`,
                },
                body: JSON.stringify(post)
            }).then(response => {
                if (response.ok) {
                    alert("ok")
                    // window.location.href = "https://tdp.yuvagalamapp.com/{{user.user_name}}/posts/"
                }
                return (response.json())
            })
                .then(data => {
                    alert("done")
                })
        } 
    </script>
    <script>

        async function srcToFile(e, context, asset) {
            const files = e.target.files.fileList;
            let results = [];
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const data = file.data;
                const name = file.name;
                const mimeType = file.type;

                await fetch(data)
                    .then(function (res) {
                        const r = res.arrayBuffer();
                        console.warn('resource ', r);
                        return r;
                    })
                    .then(function (buf) {
                        console.warn('buffer: ', [buf]);
                        const fileData = { data: [buf], name: name, type: mimeType };
                        results.push(fileData);
                        console.warn('results of file: ', fileData);
                    });
            }
            console.warn(results);
            return results;
        }



    </script>


</body>

</html>